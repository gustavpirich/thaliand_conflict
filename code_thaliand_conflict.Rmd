---
title: "Wyss -- Assignment"
author:
  - "Gustav Pirich (h11910449)"
date: "May 4, 2024"
output:
  pdf_document:
    toc: true
    includes:
      in_header: !expr file.path("~/Desktop/GITHUB/spatial_econ/helper/wraper_code.tex")
bibliography: references.bib
nocite: '@*'
header-includes:
  - \usepackage{tcolorbox}
  - \usepackage[default]{lato}
  - \usepackage{rotating}
  - \usepackage{dcolumn}
  - \usepackage{booktabs}
papersize: a4
geometry: margin=2cm
urlcolor: DarkOrchid!65!black
---


```{r, setup, echo = FALSE, warning=FALSE, results = 'hide'}
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
knitr::opts_chunk$set(tidy.opts = list(width.cutoff = 80), tidy = TRUE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 

pacman::p_load(spatialreg, showtext, magritr, bsreg, spdep, patchwork, gridExtra, fixest, splm, stringi, stringr, stringdist, haven, sf, dplyr, fuzzyjoin, comparator, digest, zoomerjoin, ggplot2, tidyr, ggthemes, viridis, rmapshaper, fixest, conleyreg, plm, stargazer, bsreg, igraph, generics, knitr, kableExtra, formatR,readxl, haven, flextable, broom, units, sysfonts, showtextdb, tmap)
```

\vspace{2em}

\begin{tcolorbox}
\centering \itshape The code that was used in compiling the assignment is available on GitHub at \url{https://github.com/gustavpirich/spatial_econ/blob/main/03_assignment/03_assignmnet.Rmd}.
\end{tcolorbox}

\newpage


```{r}

thai_0 <- read_sf("gadm41_THA_shp/gadm41_THA_0.shp")

thai_1 <- read_sf("gadm41_THA_shp/gadm41_THA_1.shp")

conflict <- readRDS("ged241.rds")

thai_conflict <- conflict %>%
  filter(country == "Thailand") %>%
  st_as_sf(coords = c("latitude", "longitude"))

thai_conflict <- st_set_crs(thai_conflict, 4326)


year <- 1992:2020

# Create a dataframe with all combinations
expanded_df <- expand.grid(thai_1$NAME_1, year)

names(expanded_df) <- c("NAME_1", "year")

# Simplify the polygons in expanded_df to reduce complexity
# Adjust 'keep' parameter as needed to balance between simplicity and accuracy
thai_1 <- ms_simplify(thai_1, keep = 0.1)

expanded_df <- expanded_df %>%
  left_join(thai_1) %>%
  st_as_sf()

# Spatial join to match conflicts to provinces
joined_data <- st_join(expanded_df, thai_conflict, join = st_within)

# Count conflicts by province and year
conflict_counts <- joined_data %>%
  group_by(NAME_1, year.x) %>%
  summarise(conflict_count = n(), .groups = 'drop')

# Merge conflict counts back to the original (simplified) data
final_data <- expanded_df %>%
  st_drop_geometry() %>%
  left_join(conflict_counts %>% 
              st_drop_geometry() %>% 
              rename(year = year.x), 
            by = c("NAME_1", "year"))



```



```{R}
# Create the map
tm <- tm_shape(thai_0) +
  tm_polygons(col = "lightblue", border.col = "white", alpha = 0.5) +
  tm_shape(thai_1) +
  tm_borders(col = "black") +
  tm_layout(main.title = " Thailand", main.title.position = "center")

tm
```

